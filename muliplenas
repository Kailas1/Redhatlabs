---
- name: Mount multiple NFS shares temporarily if not already mounted
  hosts: all
  become: yes
  vars:
    nfs_shares:
      - { server: "172.25.250.10:/shared", mount_point: "/mnt/nas_share1/" }
      - { server: "172.25.250.11:/nas_shared_B", mount_point: "/mnt/nas_share2/" }
      # Add more shares as needed
  tasks:
    - name: Process NFS shares
      ansible.builtin.include_tasks: multi_nfs_tasks.yml
      loop: "{{ nfs_shares }}"
      loop_control:
        loop_var: item

- name: Check if NFS share is already mounted
  ansible.builtin.command: findmnt -n {{ item.mount_point }}
  register: mount_check
  ignore_errors: yes
  changed_when: false

- name: Mount NFS share
  ansible.builtin.command: >
    mount -t nfs {{ item.server }} {{ item.mount_point }}
  when: mount_check.rc != 0
  register: mount_result

- name: Show mount result
  ansible.builtin.debug:
    msg: "NFS share {{ item.server }} was mounted successfully to {{ item.mount_point }}"
  when: mount_check.rc != 0 and mount_result.rc == 0

- name: Show already mounted message
  ansible.builtin.debug:
    msg: "NFS share {{ item.server }} is already mounted on {{ item.mount_point }}"
  when: mount_check.rc == 0

- name: Show mount results
  ansible.builtin.debug:
    msg: 
    	Home directory created: {{ item.item.mount_point }}/{{ item.item.home_dir }}
